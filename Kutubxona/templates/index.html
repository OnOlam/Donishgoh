{% extends "base.html" %}
{% block content %}

<!-- Tutorial Overlay -->
<div id="tutorial-overlay" class="tutorial-overlay">
  <div class="tutorial-box">
    <h3 class="tutorial-title">–•—É—à –æ–º–∞–¥–µ–¥ –±–∞ –∫–∏—Ç–æ–±—Ö–æ–Ω–∞! üéâ</h3>
    <div class="tutorial-content">
      <div class="tutorial-step" data-step="1">
        <h4>1. –î–∞—Ä –±–æ—Ä–∞–∏ —Å–∞–π—Ç</h4>
        <p>–®—É–º–æ –º–µ—Ç–∞–≤–æ–Ω–µ–¥ –¥–∞—Ä –∏–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫–∏—Ç–æ–±“≥–æ, –±–∞—Ä–Ω–æ–º–∞“≥–æ, —Ç–∞—Å–≤–∏—Ä“≥–æ –≤–∞ –≤–∏–¥–µ–æ“≥–æ—Ä–æ –ø–∞–π–¥–æ –∫—É–Ω–µ–¥. –ë–∞—Ä–æ–∏ –¥–∞—Å—Ç—Ä–∞—Å”£ –±–∞ “≥–∞—Ä —è–∫ –º–∞–≤–æ–¥ –∞–∑ –∫–æ—Ä—Ç“≥–æ–∏ –æ–º–æ—Ä–∏–∏ –∑–µ—Ä –∏—Å—Ç–∏—Ñ–æ–¥–∞ –±–∞—Ä–µ–¥.</p>
      </div>
      <div class="tutorial-step" data-step="2" style="display:none">
        <h4>2. –ú–∞–≤–æ–¥“≥–æ</h4>
        <p><strong>–ö–∏—Ç–æ–±“≥–æ:</strong> PDF, EPUB –≤–∞ –¥–∏–≥–∞—Ä —Ñ–æ—Ä–º–∞—Ç“≥–æ–∏ –∫–∏—Ç–æ–±“≥–æ<br>
        <strong>–ë–∞—Ä–Ω–æ–º–∞“≥–æ:</strong> Android, Windows –≤–∞ –±–∞—Ä–æ–∏ –¥–∏–≥–∞—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞“≥–æ<br>
        <strong>–†–∞—Å–º“≥–æ:</strong> –û–±–æ–∏ –¥–µ–≤–æ—Ä”£, —Ç–∞—Ä“≥—Ä–µ–∑”£ –≤–∞ “ì–∞–π—Ä–∞.<br>
        <strong>–í–∏–¥–µ–æ“≥–æ:</strong> –ö–∏—Ç–æ–±“≥–æ–∏ –¥–∞—Ä—Å”£, —Ñ–∏–ª–º“≥–æ –≤–∞ –¥–∏–≥–∞—Ä –≤–∏–¥–µ–æ“≥–æ</p>
      </div>
      <div class="tutorial-step" data-step="3" style="display:none">
        <h4>3. –ß”£ —Ç–∞–≤—Ä –∏—Å—Ç–∏—Ñ–æ–¥–∞ –±—É—Ä–¥–∞–Ω –º—É–º–∫–∏–Ω –∞—Å—Ç?</h4>
        <p>‚úÖ <strong>–¢–∞—Ñ—Å–∏–ª–æ—Ç–∏ –±–µ—à—Ç–∞—Ä</strong> —Ç—É–≥–º–∞—Ä–æ –ø–∞—Ö—à –∫—É–Ω–µ–¥<br>
        ‚úÖ –î–∞—Ä –±–æ—Ä–∞–∏ –º–∞–≤–æ–¥ –º–∞—ä–ª—É–º–æ—Ç –≥–∏—Ä–µ–¥<br>
        ‚úÖ <strong>–ë–æ—Ä–≥–∏—Ä”£</strong> –∑–∞—Ö–∏—Ä–∞ –∫–∞—Ä–¥–∞–Ω —Ç–∞–≤–∞—Å—Å—É—Ç–∏ —Ç—É–≥–º–∞<br>
        ‚úÖ –°–∞–±—Ç–∏ –Ω–æ–º –∫—É–Ω–µ–¥ –≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —à–∞–≤–µ–¥!</p>
      </div>
    </div>
    <div class="tutorial-buttons">
      <button class="tutorial-btn tutorial-prev" onclick="tutorialPrev()">‚¨Ö –ë–∞—Ä–≥–∞—à—Ç</button>
      <button class="tutorial-btn tutorial-next" onclick="tutorialNext()">–ë–∞—ä–¥”£ ‚û°</button>
      <button class="tutorial-btn tutorial-close" onclick="closeTutorial()" style="display:none">–ü”Ø—à–∏–¥–∞–Ω ‚úì</button>
    </div>
  </div>
</div>

<div class="welcome-card">
  <h2>üåü –•—É—à –æ–º–∞–¥–µ–¥ –±–∞ –∫–∏—Ç–æ–±—Ö–æ–Ω–∞.</h2>
  <p class="small">–ö–∏—Ç–æ–±“≥–æ–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω”£, –±–∞—Ä–Ω–æ–º–∞“≥–æ, —Ç–∞—Å–≤–∏—Ä“≥–æ –≤–∞ –≤–∏–¥–µ–æ“≥–æ—Ä–æ —Ä–æ–π–≥–æ–Ω –∑–µ—Ä–∫–∞—à”£ –∫—É–Ω–µ–¥!</p>
  <button class="btn tutorial-trigger" onclick="showTutorial()">‚ùì –ß”£ —Ç–∞–≤—Ä –∞–∑ —Å–∞–π—Ç –∏—Å—Ç–∏—Ñ–æ–¥–∞ –±—É—Ä–¥–∞–Ω –º—É–º–∫–∏–Ω –∞—Å—Ç?</button>
</div>

<div style="height:24px"></div>

<h3 style="text-align:center; margin-bottom:16px">üìä –û–º–æ—Ä–∏ —Å–∞–π—Ç</h3>

<div class="stats-grid">
  <div class="stat-card" data-type="book">
    <div class="stat-icon">üìö</div>
    <div class="stat-number">{{ stats.books }}</div>
    <div class="stat-label">–ö–∏—Ç–æ–±“≥–æ</div>
    <a class="btn" href="{{ url_for('materials', material_type='book') }}">–¢–∞—Ñ—Å–∏–ª–æ—Ç–∏ –±–µ—à—Ç–∞—Ä ‚ûú</a>
  </div>

  <div class="stat-card" data-type="app">
    <div class="stat-icon">üì±</div>
    <div class="stat-number">{{ stats.apps }}</div>
    <div class="stat-label">–ë–∞—Ä–Ω–æ–º–∞“≥–æ</div>
    <a class="btn" href="{{ url_for('materials', material_type='app') }}">–¢–∞—Ñ—Å–∏–ª–æ—Ç–∏ –±–µ—à—Ç–∞—Ä ‚ûú</a>
  </div>

  <div class="stat-card" data-type="image">
    <div class="stat-icon">üñºÔ∏è</div>
    <div class="stat-number">{{ stats.images }}</div>
    <div class="stat-label">–†–∞—Å–º“≥–æ</div>
    <a class="btn" href="{{ url_for('materials', material_type='image') }}">–¢–∞—Ñ—Å–∏–ª–æ—Ç–∏ –±–µ—à—Ç–∞—Ä ‚ûú</a>
  </div>

  <div class="stat-card" data-type="video">
    <div class="stat-icon">üé¨</div>
    <div class="stat-number">{{ stats.videos }}</div>
    <div class="stat-label">–í–∏–¥–µ–æ“≥–æ</div>
    <a class="btn" href="{{ url_for('materials', material_type='video') }}">–¢–∞—Ñ—Å–∏–ª–æ—Ç–∏ –±–µ—à—Ç–∞—Ä ‚ûú</a>
  </div>
</div>

<div style="height:24px"></div>

<div class="card info-card">
  <h4>üí° –•–∏–∑–º–∞—Ç—Ä–∞—Å–æ–Ω–∏–∏ –∫–æ—Ä–±–∞—Ä</h4>
  <ul class="info-list">
    <li>‚úì “≤–∞–º–∞–∏ –º–∞–≤–æ–¥“≥–æ —Ä–æ–π–≥–æ–Ω –∑–µ—Ä–∫–∞—à”£ –∫–∞—Ä–¥–∞ –º–µ—à–∞–≤–∞–Ω–¥</li>
    <li>‚úì –ë–∞ “õ–∞–π–¥ –≥–∏—Ä–µ–¥ –≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —à–∞–≤–µ–¥</li>
    <li>‚úì –ú–∞–≤–æ–¥“≥–æ–∏ —Ö—É–¥—Ä–æ –±–æ—Ä –∫—É–Ω–µ–¥</li>
    <li>‚úì –û–º–æ—Ä–∏ –ø–∞–π–≥–∏—Ä”£</li>
  </ul>
</div>

<script>
let tutorialStep = 1;
const maxSteps = 3;

function showTutorial() {
  document.getElementById('tutorial-overlay').style.display = 'flex';
  tutorialStep = 1;
  updateTutorialStep();
}

function closeTutorial() {
  document.getElementById('tutorial-overlay').style.display = 'none';
  fetch('/api/tutorial-seen', {method: 'POST'});
}

function tutorialNext() {
  if (tutorialStep < maxSteps) {
    tutorialStep++;
    updateTutorialStep();
  }
}

function tutorialPrev() {
  if (tutorialStep > 1) {
    tutorialStep--;
    updateTutorialStep();
  }
}

function updateTutorialStep() {
  document.querySelectorAll('.tutorial-step').forEach((el, idx) => {
    el.style.display = (idx + 1 === tutorialStep) ? 'block' : 'none';
  });
  
  document.querySelector('.tutorial-prev').style.display = tutorialStep > 1 ? 'inline-block' : 'none';
  document.querySelector('.tutorial-next').style.display = tutorialStep < maxSteps ? 'inline-block' : 'none';
  document.querySelector('.tutorial-close').style.display = tutorialStep === maxSteps ? 'inline-block' : 'none';
}

// Agar birinchi marta kirilgan bo'lsa, tutorialni ko'rsatish
if (!localStorage.getItem('tutorial_seen')) {
  setTimeout(() => {
    showTutorial();
    localStorage.setItem('tutorial_seen', 'true');
  }, 500);
}
</script>

{% endblock %}
